
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="Formulario de registro para miembros de Atomy">
  <title>Registro Atomy</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    :root {
      --primary-color: #5ab9ea;
      --primary-hover: #489ac4;
      --text-color: #333;
      --text-secondary: #555;
      --background: #f4f7f6;
      --container-bg: #fff;
      --border-color: #ddd;
      --error-color: #dc3545;
      --success-color: #28a745;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background-color: var(--background);
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    .container {
      background-color: var(--container-bg);
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      padding: 30px;
      max-width: 600px;
      width: 100%;
    }
    
    h2 {
      text-align: center;
      color: var(--text-color);
      margin-bottom: 20px;
    }
    
    form {
      display: flex;
      flex-direction: column;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      font-weight: 500;
      margin-bottom: 5px;
      color: var(--text-secondary);
      display: block;
    }
    
    input, select {
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 16px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
    }
    
    input:focus, select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(90, 185, 234, 0.2);
    }
    
    .input-error {
      border-color: var(--error-color);
    }
    
    .error-message {
      color: var(--error-color);
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    
    button {
      padding: 12px;
      font-size: 16px;
      color: #fff;
      background-color: var(--primary-color);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 10px;
    }
    
    button:hover {
      background-color: var(--primary-hover);
    }
    
    button:disabled {
      background-color: var(--border-color);
      cursor: not-allowed;
    }
    
    .hidden {
      display: none;
    }
    
    #loaderContainer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
      background: rgba(231, 231, 231, 0.8);
      z-index: 1000;
    }
    
    .loader {
      position: relative;
      width: 54px;
      height: 54px;
      border-radius: 10px;
    }
    
    .loader div {
      width: 8%;
      height: 24%;
      background: rgb(128, 128, 128);
      position: absolute;
      left: 50%;
      top: 30%;
      opacity: 0;
      border-radius: 50px;
      box-shadow: 0 0 3px rgba(0,0,0,0.2);
      animation: fade458 1s linear infinite;
    }
    
    @keyframes fade458 {
      from { opacity: 1; }
      to { opacity: 0.25; }
    }
    
    .loader .bar1 { transform: rotate(0deg) translate(0, -130%); animation-delay: 0s; }
    .loader .bar2 { transform: rotate(30deg) translate(0, -130%); animation-delay: -1.1s; }
    .loader .bar3 { transform: rotate(60deg) translate(0, -130%); animation-delay: -1s; }
    .loader .bar4 { transform: rotate(90deg) translate(0, -130%); animation-delay: -0.9s; }
    .loader .bar5 { transform: rotate(120deg) translate(0, -130%); animation-delay: -0.8s; }
    .loader .bar6 { transform: rotate(150deg) translate(0, -130%); animation-delay: -0.7s; }
    .loader .bar7 { transform: rotate(180deg) translate(0, -130%); animation-delay: -0.6s; }
    .loader .bar8 { transform: rotate(210deg) translate(0, -130%); animation-delay: -0.5s; }
    .loader .bar9 { transform: rotate(240deg) translate(0, -130%); animation-delay: -0.4s; }
    .loader .bar10 { transform: rotate(270deg) translate(0, -130%); animation-delay: -0.3s; }
    .loader .bar11 { transform: rotate(300deg) translate(0, -130%); animation-delay: -0.2s; }
    .loader .bar12 { transform: rotate(330deg) translate(0, -130%); animation-delay: -0.1s; }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      display: none; 
      align-items: center;
      min-width: 250px;
      padding: 15px 20px;
      border-radius: 8px;
      border: solid 0.5px rgb(197, 197, 197);
      color: #fff;
      font-family: sans-serif;
      font-size: 16px;
      z-index: 9999;
      transition: opacity 0.5s ease-in-out;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .toast.success {
      background-color: var(--success-color);
    }
    
    .toast.error {
      background-color: var(--error-color);
    }
    
    .toast svg {
      margin-right: 10px;
    }
    
    .file-upload {
      border: 2px dashed var(--border-color);
      border-radius: 4px;
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
      position: relative;
    }
    
    .file-upload.dragover {
      border-color: var(--primary-color);
      background-color: rgba(90, 185, 234, 0.05);
    }
    
    .file-upload-input {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
    
    .file-upload-label {
      display: block;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .file-upload-icon {
      display: block;
      font-size: 24px;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    
    .file-preview {
      display: none;
      max-width: 100%;
      margin-top: 10px;
      border-radius: 4px;
      max-height: 200px;
    }
    
    .file-name {
      margin-top: 10px;
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .terms-checkbox {
      display: flex;
      align-items: flex-start;
      margin: 15px 0;
    }
    
    .terms-checkbox input {
      width: 18px;
      height: 18px;
      margin-right: 10px;
      margin-top: 2px;
    }
    
    @media screen and (max-width: 480px) {
      .container {
        padding: 20px;
      }
      
      body {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="loaderContainer">
    <div class="loader">
      <div class="bar1"></div>
      <div class="bar2"></div>
      <div class="bar3"></div>
      <div class="bar4"></div>
      <div class="bar5"></div>
      <div class="bar6"></div>
      <div class="bar7"></div>
      <div class="bar8"></div>
      <div class="bar9"></div>
      <div class="bar10"></div>
      <div class="bar11"></div>
      <div class="bar12"></div>
    </div>
  </div>
  
  <div class="container">
    <h2>Registro de Miembro</h2>
    <form id="miembroForm" novalidate>
      <!-- CSRF Token - This would be generated server-side -->
      <input type="hidden" id="csrf_token" name="csrf_token" value="GENERATED_TOKEN">
      
      <div class="form-group">
        <label for="nombre">Nombre Completo:</label>
        <input type="text" id="nombre" name="nombre" required aria-required="true">
        <div class="error-message" id="nombre-error">Por favor ingrese su nombre completo.</div>
      </div>
      
      <div class="form-group">
        <label for="apellidos">Apellidos:</label>
        <input type="text" id="apellidos" name="apellidos" required aria-required="true">
        <div class="error-message" id="apellidos-error">Por favor ingrese sus apellidos.</div>
      </div>
      
      <div class="form-group">
        <label for="cedula">N√∫mero de C√©dula:</label>
        <input type="text" id="cedula" name="cedula" required aria-required="true" pattern="[0-9]{6,12}">
        <div class="error-message" id="cedula-error">Por favor ingrese un n√∫mero de c√©dula v√°lido.</div>
      </div>
      
      <div class="form-group">
        <div class="file-upload">
          <div class="file-upload-icon">üìÅ</div>
          <label class="file-upload-label" for="fileInput">Arrastra o haz clic para subir documento</label>
          <input type="file" id="fileInput" class="file-upload-input" accept="image/*" required aria-required="true">
          <img id="imagePreview" class="file-preview" alt="Vista previa del documento">
          <div class="file-name" id="fileName"></div>
        </div>
        <div class="error-message" id="fileInput-error">Por favor seleccione una imagen de su documento.</div>
      </div>
      
      <div class="form-group">
        <label for="fechaN">Fecha de Nacimiento:</label>
        <input type="text" id="fechaN" class="date-input" name="fechaN" placeholder="DD/MM/AAAA" required aria-required="true">
        <div class="error-message" id="fechaN-error">Por favor seleccione una fecha de nacimiento v√°lida.</div>
      </div>
      
      <div class="form-group">
        <label for="email">Correo Electr√≥nico:</label>
        <input type="email" id="email" name="email" required aria-required="true">
        <div class="error-message" id="email-error">Por favor ingrese un correo electr√≥nico v√°lido.</div>
      </div>
      
      <div class="form-group">
        <label for="departamento">Departamento:</label>
        <select id="departamento" name="departamento" required aria-required="true">
          <option value="">Seleccione un departamento</option>
        </select>
        <div class="error-message" id="departamento-error">Por favor seleccione un departamento.</div>
      </div>
      
      <div class="form-group">
        <label for="ciudad">Ciudad/Municipio:</label>
        <select id="ciudad" name="ciudad" required aria-required="true">
          <option value="">Seleccione una ciudad</option>
        </select>
        <div class="error-message" id="ciudad-error">Por favor seleccione una ciudad o municipio.</div>
      </div>
      
      <div class="form-group">
        <label for="direccion">Direcci√≥n:</label>
        <input type="text" id="direccion" name="direccion" required aria-required="true">
        <div class="error-message" id="direccion-error">Por favor ingrese su direcci√≥n.</div>
      </div>
      
      <div class="form-group">
        <label for="mibarro">Barrio:</label>
        <input type="text" id="mibarro" name="mibarro" required aria-required="true">
        <div class="error-message" id="mibarro-error">Por favor ingrese su barrio.</div>
      </div>
      
      <div class="terms-checkbox">
        <input type="checkbox" id="terms" name="terms" required aria-required="true">
        <label for="terms">
          Acepto los <a href="https://www.atomy.com/co/home/Common/ProtectPrivacy" target="_blank" rel="noopener noreferrer">T√©rminos y Condiciones</a>
        </label>
      </div>
      <div class="error-message" id="terms-error">Debe aceptar los t√©rminos y condiciones.</div>
      
      <button type="submit" id="submitButton">Enviar</button>
    </form>
  </div>
  
  <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <span id="toastIcon"></span>
    <span id="toastMessage"></span>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script defer>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize form elements
      initializeDatePicker();
      initializeFileUpload();
      loadDepartments();
      setupFormValidation();
      
      // Form submission
      document.getElementById('miembroForm').addEventListener('submit', handleFormSubmit);
    });
    
    // Constants
    const API_ENDPOINTS = {
      CLOUDINARY_UPLOAD: 'https://api.cloudinary.com/v1_1/dfuowmphp/image/upload',
      MEMBER_CREATE: 'https://miembros-u1vg.shuttle.app/miembrocreate',
      COLOMBIA_DATA: 'https://raw.githubusercontent.com/marcovega/colombia-json/master/colombia.json'
    };
    
    // Global variables
    let uploadedImageUrl = null;
    let isUploading = false;
    
    // Initialize date picker
    function initializeDatePicker() {
      flatpickr("#fechaN", {
        dateFormat: "d/m/Y",
        disableMobile: true,
        maxDate: new Date(),
        onChange: function(selectedDates, dateStr) {
          validateField('fechaN', dateStr);
        }
      });
    }
    
    // Initialize file upload
    function initializeFileUpload() {
      const fileInput = document.getElementById('fileInput');
      const imagePreview = document.getElementById('imagePreview');
      const fileName = document.getElementById('fileName');
      const dropZone = document.querySelector('.file-upload');
      
      // Handle file selection
      fileInput.addEventListener('change', function(e) {
        handleFileSelection(e.target.files[0]);
      });
      
      // Handle drag and drop
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });
      
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, function() {
          dropZone.classList.add('dragover');
        }, false);
      });
      
      ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, function() {
          dropZone.classList.remove('dragover');
        }, false);
      });
      
      dropZone.addEventListener('drop', function(e) {
        const file = e.dataTransfer.files[0];
        handleFileSelection(file);
      }, false);
      
      function handleFileSelection(file) {
        if (!file) return;
        
        // Validate file type
        if (!file.type.match('image.*')) {
          showError('fileInput', 'El archivo debe ser una imagen (JPG, PNG, etc.)');
          return;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          showError('fileInput', 'La imagen no debe exceder 5MB');
          return;
        }
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block';
          fileName.textContent = file.name;
        };
        reader.readAsDataURL(file);
        
        // Upload to Cloudinary
        uploadImageToCloudinary(file);
      }
    }
    
    // Upload image to Cloudinary
    async function uploadImageToCloudinary(file) {
      if (isUploading) return;
      
      isUploading = true;
      showLoading(true);
      
      try {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', 'ml_default');
        
        const response = await fetch(API_ENDPOINTS.CLOUDINARY_UPLOAD, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error('Error en la respuesta del servidor');
        }
        
        const data = await response.json();
        
        if (!data.secure_url) {
          throw new Error('Error al obtener secure_url');
        }
        
        uploadedImageUrl = data.secure_url;
        hideError('fileInput');
      } catch (error) {
        console.error('Error al subir la imagen:', error);
        showError('fileInput', 'No se pudo subir la imagen. Intenta nuevamente.');
        uploadedImageUrl = null;
      } finally {
        isUploading = false;
        showLoading(false);
      }
    }
    
    // Load departments
    async function loadDepartments() {
      try {
        const response = await fetch(API_ENDPOINTS.COLOMBIA_DATA);
        
        if (!response.ok) {
          throw new Error('Error al cargar el dataset');
        }
        
        const data = await response.json();
        
        // Create department-city map
        const departmentCityMap = {};
        data.forEach(item => {
          departmentCityMap[item.departamento] = item.ciudades;
        });
        
        // Populate departments dropdown
        const departmentSelect = document.getElementById('departamento');
        Object.keys(departmentCityMap).sort().forEach(department => {
          const option = document.createElement('option');
          option.value = department;
          option.textContent = department;
          departmentSelect.appendChild(option);
        });
        
        // Handle department change
        departmentSelect.addEventListener('change', function() {
          populateCities(departmentCityMap, this.value);
          validateField('departamento', this.value);
        });
      } catch (error) {
        console.error('Error al cargar el dataset:', error);
        showToast('error', 'Error al cargar los departamentos. Por favor recarga la p√°gina.');
      }
    }
    
    // Populate cities based on selected department
    function populateCities(departmentCityMap, department) {
      const citySelect = document.getElementById('ciudad');
      citySelect.innerHTML = '<option value="">Seleccione una ciudad</option>';
      
      if (department && departmentCityMap[department]) {
        departmentCityMap[department].sort().forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
      }
      
      // Clear city validation since it has been reset
      document.getElementById('ciudad-error').style.display = 'none';
      citySelect.classList.remove('input-error');
      
      // Add change listener to city select
      citySelect.addEventListener('change', function() {
        validateField('ciudad', this.value);
      });
    }
    
    // Set up form validation
    function setupFormValidation() {
      // Add blur event listeners to all required fields
      const requiredFields = document.querySelectorAll('[required]');
      requiredFields.forEach(field => {
        if (field.id !== 'fileInput' && field.id !== 'terms') {
          field.addEventListener('blur', function() {
            validateField(this.id, this.value);
          });
          
          field.addEventListener('input', function() {
            if (this.classList.contains('input-error')) {
              validateField(this.id, this.value);
            }
          });
        }
      });
      
      // Special handling for terms checkbox
      document.getElementById('terms').addEventListener('change', function() {
        validateField('terms', this.checked);
      });
      
      document.getElementById('ciudad').addEventListener('change', function() {
        validateField('ciudad', this.value);
      });
    }
    
    // Validate a single field
    function validateField(fieldId, value) {
      switch(fieldId) {
        case 'nombre':
        case 'apellidos':
          if (!value.trim()) {
            showError(fieldId, `Por favor ingrese sus ${fieldId}.`);
            return false;
          }
          break;
          
        case 'cedula':
          if (!value.trim()) {
            showError(fieldId, 'Por favor ingrese su n√∫mero de c√©dula.');
            return false;
          }
          if (!/^[0-9]{6,12}$/.test(value)) {
            showError(fieldId, 'Por favor ingrese un n√∫mero de c√©dula v√°lido (6-12 d√≠gitos).');
            return false;
          }
          break;
          
        case 'email':
          if (!value.trim()) {
            showError(fieldId, 'Por favor ingrese su correo electr√≥nico.');
            return false;
          }
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
            showError(fieldId, 'Por favor ingrese un correo electr√≥nico v√°lido.');
            return false;
          }
          break;
          
        case 'fechaN':
          if (!value.trim()) {
            showError(fieldId, 'Por favor seleccione su fecha de nacimiento.');
            return false;
          }
          break;
          
        case 'departamento':
        case 'ciudad':
          if (!value) {
            showError(fieldId, `Por favor seleccione un ${fieldId}.`);
            return false;
          }
          break;
          
        case 'direccion':
        case 'mibarro':
          if (!value.trim()) {
            showError(fieldId, `Por favor ingrese su ${fieldId === 'mibarro' ? 'barrio' : 'direcci√≥n'}.`);
            return false;
          }
          break;
          
        case 'terms':
          if (!value) {
            showError(fieldId, 'Debe aceptar los t√©rminos y condiciones.');
            return false;
          }
          break;
      }
      
      hideError(fieldId);
      return true;
    }
    
    // Show validation error
    function showError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorElement = document.getElementById(`${fieldId}-error`);
      
      if (field && errorElement) {
        field.classList.add('input-error');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
      }
    }
    
    // Hide validation error
    function hideError(fieldId) {
      const field = document.getElementById(fieldId);
      const errorElement = document.getElementById(`${fieldId}-error`);
      
      if (field && errorElement) {
        field.classList.remove('input-error');
        errorElement.style.display = 'none';
      }
    }
    
    // Validate the entire form
    function validateForm() {
      let isValid = true;
      
      // Validate all required fields
      const requiredFields = [
        'nombre', 'apellidos', 'cedula', 'fechaN', 
        'email', 'departamento', 'ciudad', 'direccion', 'mibarro'
      ];
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!validateField(fieldId, field.value)) {
          isValid = false;
        }
      });
      
      // Validate terms
      if (!document.getElementById('terms').checked) {
        showError('terms', 'Debe aceptar los t√©rminos y condiciones.');
        isValid = false;
      }
      
      // Validate image
      if (!uploadedImageUrl) {
        showError('fileInput', 'Por favor suba una imagen de su documento.');
        isValid = false;
      }
      
      return isValid;
    }
    
    // Handle form submission
    async function handleFormSubmit(e) {
      e.preventDefault();
      
      // Check if image is still uploading
      if (isUploading) {
        showToast('error', 'La imagen a√∫n se est√° subiendo. Por favor espere.');
        return;
      }
      
      // Validate form
      if (!validateForm()) {
        showToast('error', 'Por favor corrija los errores en el formulario.');
        return;
      }
      
      showLoading(true);
      
      try {
        // Prepare form data
        const formData = {
          nombre: document.getElementById('nombre').value,
          apellidos: document.getElementById('apellidos').value,
          cedula: document.getElementById('cedula').value,
          fechaN: document.getElementById('fechaN').value,
          email: document.getElementById('email').value,
          departamento: document.getElementById('departamento').value,
          ciudad: document.getElementById('ciudad').value,
          direccion: document.getElementById('direccion').value,
          barrio: document.getElementById('mibarro').value,
          imagen: uploadedImageUrl
        };
        
        // Send data to server
        const response = await fetch(API_ENDPOINTS.MEMBER_CREATE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.getElementById('csrf_token').value
          },
          body: JSON.stringify(formData)
        });
        
        if (!response.ok) {
          throw new Error(`Error del servidor: ${response.status}`);
        }
        
        const result = await response.text();
        
        // Reset form
        document.getElementById('miembroForm').reset();
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('fileName').textContent = '';
        uploadedImageUrl = null;
        
        showToast('success', 'Registro completado con √©xito.');
      } catch (error) {
        console.error('Error al enviar los datos:', error);
        showToast('error', 'Error al enviar los datos. Por favor intente nuevamente.');
      } finally {
        showLoading(false);
      }
    }
    
    // Show/hide loading spinner
    function showLoading(show) {
      document.getElementById('loaderContainer').style.display = show ? 'flex' : 'none';
      document.getElementById('submitButton').disabled = show;
    }
    
    // Show toast notification
    function showToast(type, message) {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toastIcon');
      const toastMessage = document.getElementById('toastMessage');
  
      toast.className = 'toast ' + type;
      if (type === 'success') {
    toastIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="#fff">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
      </svg>
    `;
  } else {
    toastIcon.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#fff">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>
    `;
  }
  
  // Set message
  toastMessage.textContent = message;

  toast.style.display = 'flex';

  setTimeout(() => {
    toast.style.display = 'none';
  }, 3000);
}

// Helper function to debounce function calls
function debounce(func, wait) {
  let timeout;
  return function(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

// Add window beforeunload event to prevent accidental form abandonment
window.addEventListener('beforeunload', function(e) {
  const form = document.getElementById('miembroForm');
  const formElements = form.elements;
  let formFilled = false;
  
  // Check if any field has a value
  for (let i = 0; i < formElements.length; i++) {
    const element = formElements[i];
    if (element.type !== 'submit' && element.type !== 'hidden' && element.value) {
      formFilled = true;
      break;
    }
  }
  
  if (formFilled && !form.submitted) {
    e.preventDefault();
    e.returnValue = '¬øEst√° seguro que desea abandonar la p√°gina? Los datos ingresados no se guardar√°n.';
    return e.returnValue;
  }
});
  </script>
</body>
</html>
